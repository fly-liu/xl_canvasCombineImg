"use strict";function CanvasCombineImg(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;this.width=a,this.height=b,this.DEAW_ING=!1,this.queue=[],this.init()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,CanvasCombineImg.prototype={init:function(){this.canvas=document.createElement("canvas"),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width,this.canvas.height=this.height,this.box=document.createElement("div"),this.box.style.height=0,this.box.style.overflow="hidden",this.box.appendChild(this.canvas),document.body.appendChild(this.box),this.cxt=this.canvas.getContext("2d")},add:function(a,b,c,d,e,f){function l(a,f){g||(g=!0,f&&(h.roundedRect(b,c,d,e,f),i.clip()),i.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,b,c,d,e),h.addEnd())}var k,g=!1,h=this,i=h.cxt,j=h.DEAW_ING;return f=f||0,j?(this.queue.push({img:a,x:b,y:c,width:d,height:e,radius:f}),void 0):(this.DEAW_ING=!0,"string"!=typeof a?l(a,f):(k=new Image,k.onload=function(){l(k,f)},k.crossOrigin="anonymous",k.src=a,k.complete&&l(k,f)),void 0)},roundedRect:function(a,b,c,d,e){var f=this.cxt;f.strokeStyle="#fff",f.beginPath(),f.moveTo(a,b+e),f.lineTo(a,b+d-e),f.quadraticCurveTo(a,b+d,a+e,b+d),f.lineTo(a+c-e,b+d),f.quadraticCurveTo(a+c,b+d,a+c,b+d-e),f.lineTo(a+c,b+e),f.quadraticCurveTo(a+c,b,a+c-e,b),f.lineTo(a+e,b),f.quadraticCurveTo(a,b,a,b+e),f.stroke()},setFontFamily:function(a){this.family=a},addText:function(a,b,c,d){function r(c){var d,e,g,h;if(c){for(d=0,e=1;e<c.length;e++)g=c.slice(0,e),h=p.cxt.measureText(g).width,h>o&&0==d&&(d=e-1);if(d>1)return f.fillText(c.slice(0,d),a,b),b=(k-i)/2+b+i,r(c.slice(d)),void 0;f.fillText(c,a,b),p.addEnd()}}var h,i,j,k,l,m,n,o,p,q,f=(this.addEnd,this.cxt),g=this.DEAW_ING;return g?(this.queue.push({x:a,y:b,text:c,options:d}),void 0):(this.DEAW_ING=!0,h=d.fontSize,i=void 0===h?18:h,j=d.lineHeight,k=void 0===j?18:j,l=d.color,m=void 0===l?"#000000":l,n=d.width,o=void 0===n?1e4:n,p=this,q=this.family||"Helvetica,STHeiTi,sans-serif",f.restore(),f.save(),f.textBaseline="top",f.font="".concat(i,"px ").concat(q),f.fillStyle=m,b=(k-i)/2+b,r(c),void 0)},save:function(a){var d,e,b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.queue.length>0||this.DEAW_ING?(setTimeout(function(){b.save(a,c)},200),void 0):(d=this.canvas.toDataURL("image/jpeg",c),e=this.convertBase64UrlToBlob(d),this.box.parentNode.removeChild(this.box),a&&a({base64:d,file:e}),void 0)},convertBase64UrlToBlob:function(a){for(var b=a.split(","),c=b[0].match(/:(.*?);/)[1],d=atob(b[1]),e=d.length,f=new Uint8Array(e);e--;)f[e]=d.charCodeAt(e);return new Blob([f],{type:c,lastModified:Date.now()})},addEnd:function(){var a,b,c,d,e,f,g,h,i;this.DEAW_ING=!1,a=this.queue.shift(),a&&(b=a.img,c=a.x,d=a.y,e=a.width,f=a.height,g=a.text,h=a.options,i=a.radius,b?this.add(b,c,d,e,f,i):this.addText(c,d,g,h))}};var _default=CanvasCombineImg;exports.default=_default;